import $ from 'jquery';
import * as uiCommon from './common.js';
import { renderCategoryForm } from './forms.js';
import * as auth from '../core/auth.js';

export function getRoleBadgeClass(role) { switch (role) { case 'admin': return 'danger'; case 'editor': return 'warning'; case 'author': return 'info'; case 'reader': return 'secondary'; default: return 'light'; } }
export function renderCategoryAdminList(categories) { const contentArea = uiCommon.contentArea; const categoryFormHtml = renderCategoryForm(); contentArea.html(` <div class="d-flex justify-content-between align-items-center mb-3"> <h2>Categories</h2> <button class="btn btn-primary" id="add-category-btn"><i class="bi bi-plus-circle"></i> Add</button> </div> <div id="category-form-container" class="mb-3" style="display: none;"> ${categoryFormHtml} </div> <table class="table table-striped table-hover align-middle"> <thead> <tr> <th>ID</th> <th>Name</th> <th>Slug</th> <th class="text-end">Actions</th> </tr> </thead> <tbody id="category-list"> ${categories?.length ? categories.map(c => ` <tr data-id="${c.id}" data-name="${c.name}" data-slug="${c.slug}"> <td>${c.id}</td> <td class="cat-name">${c.name}</td> <td class="cat-slug">${c.slug}</td> <td class="text-end"> <button class="btn btn-sm btn-warning btn-edit-category me-1" data-id="${c.id}"><i class="bi bi-pencil"></i></button> <button class="btn btn-sm btn-danger btn-delete-category" data-id="${c.id}"><i class="bi bi-trash"></i></button> </td> </tr>`).join('') : `<tr><td colspan="4" class="text-center text-muted">None found.</td></tr>` } </tbody> </table> `); }
export function renderUserAdminList(users) { const contentArea = uiCommon.contentArea; const currentUser = auth.getCurrentUser(); contentArea.html(` <div class="d-flex justify-content-between align-items-center mb-3"> <h2>Users</h2> <a href="/admin/users/user/add/" target="_blank" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Add (Admin)</a> </div> <p class="text-muted small">Full management via <a href="/admin/users/" target="_blank">Django Admin</a>.</p> <table class="table table-striped table-hover align-middle"> <thead> <tr> <th>ID</th> <th>Username</th> <th>Email</th> <th>Role</th> <th>Staff</th> <th>Active</th> <th>Joined</th> <th class="text-end">Actions</th> </tr> </thead> <tbody> ${users?.length ? users.map(u => ` <tr> <td>${u.id}</td> <td>${u.username} ${u.id == currentUser.userId ? '<span class="badge bg-info text-dark ms-1">You</span>':''}</td> <td>${u.email||'-'}</td> <td><span class="badge bg-${getRoleBadgeClass(u.role)}">${u.role}</span></td> <td>${u.is_staff ? '<i class="bi bi-check-circle-fill text-success"></i>' : '<i class="bi bi-x-circle text-danger"></i>'}</td> <td>${u.is_active ? '<i class="bi bi-check-circle-fill text-success"></i>' : '<i class="bi bi-x-circle text-danger"></i>'}</td> <td>${new Date(u.date_joined).toLocaleDateString()}</td> <td class="text-end"> <a href="#admin/users/edit/${u.id}" class="btn btn-sm btn-warning btn-edit-user" data-user-id="${u.id}"><i class="bi bi-pencil"></i> Edit</a> </td> </tr> `).join('') : `<tr><td colspan="8" class="text-center text-muted">None found.</td></tr>`} </tbody> </table> <div id="pagination-controls"></div> `); }
export function renderTagAdminList(tags) { const contentArea = uiCommon.contentArea; contentArea.html(` <div class="d-flex justify-content-between align-items-center mb-3"> <h2>Tags</h2> <span class="text-muted small">Managed via posts</span> </div> <div class="d-flex flex-wrap gap-2"> ${tags?.length ? tags.map(t => ` <a href="#posts/by_tag/${t.name}" class="tag fs-6" title="${t.post_count} posts"> ${t.name} <span class="badge bg-secondary rounded-pill ms-1">${t.post_count}</span> </a> `).join('') : '<p class="text-muted">None found.</p>'} </div> <div id="pagination-controls" class="mt-3"></div> `); }
export function renderUserEditForm(user) { const contentArea = uiCommon.contentArea; const roleChoices = [ { value: 'admin', label: 'Admin' }, { value: 'editor', label: 'Editor' }, { value: 'author', label: 'Author' }, { value: 'reader', label: 'Reader' }, ]; const formHtml = ` <h2>Edit User: ${user.username}</h2> <form id="user-edit-form" data-user-id="${user.id}"> <div class="row"> <div class="col-md-8"> <div class="mb-3"> <label for="user-username" class="form-label">Username</label> <input type="text" class="form-control" id="user-username" value="${user.username || ''}" > <div class="form-text text-danger">Warning: Changing username might have side effects.</div> </div> <div class="mb-3"> <label for="user-email" class="form-label">Email</label> <input type="email" class="form-control" id="user-email" value="${user.email || ''}" > </div> <div class="mb-3"> <label for="user-first-name" class="form-label">First Name</label> <input type="text" class="form-control" id="user-first-name" value="${user.first_name || ''}" > </div> <div class="mb-3"> <label for="user-last-name" class="form-label">Last Name</label> <input type="text" class="form-control" id="user-last-name" value="${user.last_name || ''}" > </div> <div class="mb-3"> <label for="user-bio" class="form-label">Bio</label> <textarea class="form-control" id="user-bio" rows="4">${user.bio || ''}</textarea> </div> </div> <div class="col-md-4"> <div class="mb-3"> <label for="user-role" class="form-label">Role</label> <select id="user-role" class="form-select"> ${roleChoices.map(r => `<option value="${r.value}" ${user.role === r.value ? 'selected' : ''}>${r.label}</option>`).join('')} </select> </div> <div class="form-check mb-2"> <input class="form-check-input" type="checkbox" id="user-is-staff" ${user.is_staff ? 'checked' : ''}> <label class="form-check-label" for="user-is-staff"> Staff Status (Admin Access) </label> </div> <div class="form-check mb-3"> <input class="form-check-input" type="checkbox" id="user-is-active" ${user.is_active !== false ? 'checked' : ''}> <label class="form-check-label" for="user-is-active"> Active (Can login) </label> </div> <div class="d-grid gap-2 mt-4"> <button type="submit" class="btn btn-primary">Save Changes</button> <a href="#admin/users" class="btn btn-secondary">Cancel</a> </div> </div> </div> </form> `; contentArea.html(formHtml); }